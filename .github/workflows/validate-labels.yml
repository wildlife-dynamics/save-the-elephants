name: Validate PR Labels

on:
  pull_request:
    types: [opened, labeled, unlabeled, synchronize, reopened]

jobs:
  check-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Check for required test label
        run: |
          LABELS='${{ toJson(github.event.pull_request.labels.*.name) }}'
          echo "PR Labels: $LABELS"

          if echo "$LABELS" | jq -e 'contains(["test:unit"]) or contains(["test:local"]) or contains(["test:published"])' > /dev/null; then
            echo "✅ Valid test label found"
            exit 0
          else
            echo "❌ Error: PR must have one of the following labels:"
            echo "  - test:unit (run unit tests only)"
            echo "  - test:local (run unit tests + workflow tests with local build)"
            echo "  - test:published (run workflow tests with published packages)"
            exit 1
          fi
